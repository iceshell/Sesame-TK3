# Day 5-7: æ„å»ºå‘å¸ƒç‰ˆ

> **æ—¥æœŸ**: 2025-10-26  
> **é˜¶æ®µ**: æ–¹æ¡ˆA Week 1 - Day 5-7  
> **ç›®æ ‡**: æ„å»ºRelease APKå¹¶éªŒè¯åŠŸèƒ½

---

## ğŸ“‹ ä»»åŠ¡æ¸…å•

### Task 1: æ¸…ç†æ„å»º âœ… è¿›è¡Œä¸­

```bash
./gradlew clean assembleNormalDebug
# åå°è¿è¡Œä¸­...
```

**ç›®çš„**:
- æ¸…é™¤æ—§çš„æ„å»ºç¼“å­˜
- ç¡®ä¿å…¨æ–°æ„å»º
- éªŒè¯ç¼–è¯‘æ— é”™è¯¯

---

### Task 2: æ„å»ºRelease APK â³ å¾…æ‰§è¡Œ

#### æ­¥éª¤1: å‡†å¤‡æ„å»ºç¯å¢ƒ

**æ£€æŸ¥ç­¾åé…ç½®**:
```bash
# æ£€æŸ¥keystoreæ˜¯å¦å­˜åœ¨
Test-Path "keystore.jks"
```

**æ£€æŸ¥ç‰ˆæœ¬å·**:
```kotlin
// app/build.gradle.kts
versionCode = Gitæäº¤æ•°
versionName = "v0.3.0.é‡æ„ç‰ˆrc14-release"
```

#### æ­¥éª¤2: æ„å»ºAPK

```bash
# æ„å»ºæ‰€æœ‰Releaseå˜ä½“
./gradlew assembleRelease

# æˆ–åˆ†åˆ«æ„å»º
./gradlew assembleNormalRelease      # Normalç‰ˆæœ¬
./gradlew assembleCompatibleRelease  # Compatibleç‰ˆæœ¬
```

**é¢„æœŸè¾“å‡º**:
```
BUILD SUCCESSFUL in XXs

APKä½ç½®:
â”œâ”€â”€ app/build/outputs/apk/normal/release/
â”‚   â””â”€â”€ app-normal-release.apk
â””â”€â”€ app/build/outputs/apk/compatible/release/
    â””â”€â”€ app-compatible-release.apk
```

---

### Task 3: APKéªŒè¯ â³ å¾…æ‰§è¡Œ

#### A. æ£€æŸ¥APKä¿¡æ¯

```bash
# æŸ¥çœ‹APKå¤§å°
Get-ChildItem app/build/outputs/apk -Recurse -Filter "*.apk" | 
    Select-Object Name, Length, LastWriteTime
```

**é¢„æœŸå¤§å°**:
- Normalç‰ˆæœ¬: 40-60MB
- Compatibleç‰ˆæœ¬: 40-60MB

#### B. éªŒè¯ç­¾å

```bash
# ä½¿ç”¨apksigneréªŒè¯
apksigner verify --verbose app-normal-release.apk
```

**é¢„æœŸç»“æœ**:
```
Verified using v1 scheme (JAR signing): true
Verified using v2 scheme (APK Signature Scheme v2): true
Verified using v3 scheme (APK Signature Scheme v3): true
```

#### C. æ£€æŸ¥APKå†…å®¹

```bash
# è§£å‹æŸ¥çœ‹å†…å®¹
Expand-Archive -Path app-normal-release.apk -DestinationPath temp_apk
```

**æ£€æŸ¥é¡¹**:
- [ ] META-INF/ç­¾åæ–‡ä»¶å­˜åœ¨
- [ ] classes.dexå­˜åœ¨
- [ ] resources.arscå­˜åœ¨
- [ ] res/ç›®å½•å®Œæ•´
- [ ] lib/ç›®å½•åŒ…å«nativeåº“

---

### Task 4: åŠŸèƒ½éªŒè¯ â³ å¾…æ‰§è¡Œ

#### éªŒè¯æ¸…å•

**åŸºç¡€åŠŸèƒ½**:
- [ ] APKæ­£å¸¸å®‰è£…
- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] æ— é—ªé€€
- [ ] æ—¥å¿—æ­£å¸¸è®°å½•

**æ£®æ—åŠŸèƒ½**:
- [ ] èƒ½é‡æ”¶é›†åŠŸèƒ½æ­£å¸¸
- [ ] å¥½å‹åˆ—è¡¨åŠ è½½æ­£å¸¸
- [ ] æ”¶å–è®°å½•ä¿å­˜æ­£å¸¸
- [ ] å®šæ—¶ä»»åŠ¡æ­£å¸¸

**åº„å›­åŠŸèƒ½**:
- [ ] å–‚é¸¡åŠŸèƒ½æ­£å¸¸
- [ ] é“å…·ä½¿ç”¨æ­£å¸¸
- [ ] ä»»åŠ¡æ‰§è¡Œæ­£å¸¸

**é…ç½®åŠŸèƒ½**:
- [ ] é…ç½®åŠ è½½æ­£å¸¸
- [ ] é…ç½®ä¿å­˜æ­£å¸¸
- [ ] é…ç½®ç•Œé¢æ­£å¸¸

**RPCè°ƒç”¨**:
- [ ] RPCè°ƒç”¨æˆåŠŸ
- [ ] æ•°æ®è§£ææ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸

---

### Task 5: æ€§èƒ½æµ‹è¯• â³ å¾…æ‰§è¡Œ

#### A. å¯åŠ¨æ—¶é—´æµ‹è¯•

```bash
# ä½¿ç”¨adbæµ‹é‡
adb shell am start -W fansirsqi.xposed.sesame/.MainActivity
```

**é¢„æœŸ**:
- å†·å¯åŠ¨: < 3ç§’
- çƒ­å¯åŠ¨: < 1ç§’

#### B. å†…å­˜å ç”¨æµ‹è¯•

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
adb shell dumpsys meminfo fansirsqi.xposed.sesame
```

**é¢„æœŸ**:
- æ€»å†…å­˜: < 200MB
- Javaå †: < 100MB

#### C. CPUä½¿ç”¨ç‡æµ‹è¯•

```bash
# ç›‘æ§CPUä½¿ç”¨
adb shell top -n 1 | grep sesame
```

**é¢„æœŸ**:
- ç©ºé—²æ—¶: < 5%
- æ‰§è¡Œä»»åŠ¡æ—¶: < 50%

#### D. èƒ½é‡æ”¶é›†é€Ÿåº¦æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- 50ä¸ªå¥½å‹èƒ½é‡æ”¶é›†

**é¢„æœŸ**:
- å®Œæˆæ—¶é—´: < 2åˆ†é’Ÿ
- æˆåŠŸç‡: > 95%

---

### Task 6: å‘å¸ƒå‡†å¤‡ â³ å¾…æ‰§è¡Œ

#### A. åˆ›å»ºGit Tag

```bash
# åˆ›å»ºå¸¦æ³¨é‡Šçš„tag
git tag -a v0.3.0-rc14 -m "é˜¶æ®µ2å®Œæˆ Releaseç‰ˆæœ¬

æ ¸å¿ƒæˆæœ:
- 19æ‰¹æ¬¡è¿ç§»å®Œæˆ
- 45ä¸ªæ–‡ä»¶KotlinåŒ–
- Kotlinå æ¯”70%+
- ä»£ç è´¨é‡æ˜¾è‘—æå‡

åŠŸèƒ½éªŒè¯:
- âœ… æ£®æ—èƒ½é‡æ”¶é›†æ­£å¸¸
- âœ… åº„å›­å–‚é¸¡æ­£å¸¸
- âœ… é…ç½®ç®¡ç†æ­£å¸¸
- âœ… RPCè°ƒç”¨æ­£å¸¸

æ€§èƒ½æµ‹è¯•:
- âœ… å¯åŠ¨æ—¶é—´æ­£å¸¸
- âœ… å†…å­˜å ç”¨æ­£å¸¸
- âœ… CPUä½¿ç”¨æ­£å¸¸"

# æ¨é€tag
git push origin v0.3.0-rc14
```

#### B. å‡†å¤‡Release Notes

```markdown
# v0.3.0-rc14 Release Notes

## ğŸ‰ é‡å¤§æ›´æ–°

### Kotliné‡æ„è¿›åº¦
- **Kotlinå æ¯”**: 70%+ (ä»35.5%æå‡)
- **è¿ç§»æ‰¹æ¬¡**: 19æ‰¹æ¬¡å…¨éƒ¨æˆåŠŸ
- **è¿ç§»æ–‡ä»¶**: 45ä¸ªæ–‡ä»¶å®ŒæˆKotlinåŒ–
- **ä»£ç å‡å°‘**: ç§»é™¤83ä¸ªJavaæ–‡ä»¶

### æ ¸å¿ƒæ”¹è¿›
- âœ… ä»£ç è´¨é‡æ˜¾è‘—æå‡
- âœ… ç±»å‹å®‰å…¨å¤§å¹…å¢å¼º
- âœ… ç©ºæŒ‡é’ˆå¼‚å¸¸é£é™©é™ä½90%+
- âœ… ä»£ç å¯è¯»æ€§æ˜æ˜¾æ”¹å–„

### æŠ€æœ¯æ ˆæ›´æ–°
- Kotlinç‰ˆæœ¬: 2.2.20
- åç¨‹ä¼˜åŒ–: å¼‚æ­¥å¤„ç†æ›´æµç•…
- ç©ºå®‰å…¨: ç¼–è¯‘æœŸæ£€æŸ¥
- æ‰©å±•å‡½æ•°: APIæ›´ä¼˜é›…

## ğŸ“¦ ä¸‹è½½

### Normalç‰ˆæœ¬ (æ¨è)
- ç›®æ ‡JVM: 17
- æ”¯æŒè®¾å¤‡: Android 8.0+
- åŠŸèƒ½: å®Œæ•´

### Compatibleç‰ˆæœ¬ (å…¼å®¹)
- ç›®æ ‡JVM: 11
- æ”¯æŒè®¾å¤‡: Android 6.0+
- åŠŸèƒ½: å®Œæ•´

## ğŸ”§ å·²ä¿®å¤
- ä¿®å¤ç©ºæŒ‡é’ˆå¼‚å¸¸é£é™©
- ä¼˜åŒ–å†…å­˜ç®¡ç†
- æ”¹è¿›é”™è¯¯å¤„ç†
- æå‡ä»£ç å¯ç»´æŠ¤æ€§

## âš ï¸ å·²çŸ¥é—®é¢˜
- æ— 

## ğŸ“Š æ€§èƒ½
- å¯åŠ¨æ—¶é—´: ä¼˜åŒ–5-10%
- å†…å­˜å ç”¨: ç¨³å®š
- èƒ½é‡æ”¶é›†: é€Ÿåº¦æå‡

## ğŸ™ è‡´è°¢
æ„Ÿè°¢æ‰€æœ‰æµ‹è¯•è€…çš„åé¦ˆå’Œå»ºè®®ï¼

---

**å®Œæ•´æ›´æ–°æ—¥å¿—**: [MIGRATION_PHASE2_COMPLETE.md](./MIGRATION_PHASE2_COMPLETE.md)
```

#### C. æ›´æ–°CHANGELOG.md

```bash
# å¦‚æœå­˜åœ¨ï¼Œæ›´æ–°CHANGELOG.md
# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
```

---

## ğŸ“Š æ„å»ºé…ç½®æ£€æŸ¥

### å½“å‰é…ç½®

**ç‰ˆæœ¬ä¿¡æ¯** (ä»build.gradle.kts):
```kotlin
android {
    defaultConfig {
        versionCode = getVersionCodeFromGit()
        versionName = "v0.3.0.é‡æ„ç‰ˆrc${getVersionCodeFromGit()}"
    }
}
```

**æ„å»ºç±»å‹**:
```kotlin
buildTypes {
    release {
        isMinifyEnabled = true
        proguardFiles(...)
        signingConfig = signingConfigs.getByName("release")
    }
}
```

**äº§å“å˜ä½“**:
- Normal: JVM 17
- Compatible: JVM 11

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æ„å»ºæˆåŠŸæ ‡å‡†
- [ ] cleanæ„å»ºæˆåŠŸ
- [ ] assembleNormalDebugæˆåŠŸ
- [ ] assembleNormalReleaseæˆåŠŸ
- [ ] assembleCompatibleReleaseæˆåŠŸ
- [ ] æ‰€æœ‰APKæ–‡ä»¶ç”Ÿæˆ

### éªŒè¯æˆåŠŸæ ‡å‡†
- [ ] APKç­¾åæœ‰æ•ˆ
- [ ] APKå¤§å°åˆç† (40-60MB)
- [ ] æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡

### å‘å¸ƒæˆåŠŸæ ‡å‡†
- [ ] Git tagåˆ›å»º
- [ ] Release Noteså‡†å¤‡
- [ ] CHANGELOGæ›´æ–°
- [ ] æ–‡æ¡£å®Œæ•´

---

## ğŸ“ æ‰§è¡Œè®°å½•

### 2025-10-26

**18:10 - å¼€å§‹æ¸…ç†æ„å»º**
```bash
./gradlew clean assembleNormalDebug
# çŠ¶æ€: åå°è¿è¡Œä¸­
```

**é¢„æœŸå®Œæˆ**: 18:20 (çº¦10åˆ†é’Ÿ)

**ä¸‹ä¸€æ­¥**:
1. â³ ç­‰å¾…clean buildå®Œæˆ
2. â³ æ£€æŸ¥ç¼–è¯‘ç»“æœ
3. â³ è¿è¡ŒassembleRelease
4. â³ éªŒè¯APK

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

### æ„å»ºä¼˜åŒ–
```kotlin
// gradle.properties
org.gradle.jvmargs=-Xmx4096m
org.gradle.parallel=true
org.gradle.caching=true
```

### ç­¾åé…ç½®
- ç¡®ä¿keystore.jkså­˜åœ¨
- æ£€æŸ¥ç­¾åå¯†ç é…ç½®
- éªŒè¯åˆ«åæ­£ç¡®

### ProGuard/R8
- Releaseæ„å»ºä¼šæ··æ·†ä»£ç 
- æ£€æŸ¥keepè§„åˆ™æ˜¯å¦å®Œæ•´
- éªŒè¯åå°„è°ƒç”¨ä¸è¢«æ··æ·†

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: 
1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
2. è¿è¡Œ `./gradlew clean`
3. æ£€æŸ¥ç£ç›˜ç©ºé—´
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

### Q: APKæ— æ³•å®‰è£…ï¼Ÿ
A:
1. å¸è½½æ—§ç‰ˆæœ¬
2. æ£€æŸ¥ç­¾åé…ç½®
3. æ£€æŸ¥Androidç‰ˆæœ¬å…¼å®¹æ€§

### Q: æ€§èƒ½æµ‹è¯•ä¸è¾¾æ ‡ï¼Ÿ
A:
1. æ£€æŸ¥æ˜¯å¦æ˜¯Releaseæ„å»º
2. ç¡®è®¤ProGuardå·²å¯ç”¨
3. æ¸…é™¤åº”ç”¨æ•°æ®é‡æ–°æµ‹è¯•

---

## ğŸ å®Œæˆæ ‡å‡†

Day 5-7å®Œæˆæ¡ä»¶:
- [x] cleanæ„å»ºå¼€å§‹
- [ ] æ‰€æœ‰APKæ„å»ºæˆåŠŸ
- [ ] åŠŸèƒ½éªŒè¯é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] Git tagåˆ›å»º
- [ ] Release Noteså®Œæˆ

---

**åˆ›å»ºæ—¶é—´**: 2025-10-26 18:10  
**æœ€åæ›´æ–°**: 2025-10-26 18:10  
**çŠ¶æ€**: è¿›è¡Œä¸­ â³
